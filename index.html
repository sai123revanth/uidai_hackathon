<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIDAI Aadhaar Data Insights - Andhra Pradesh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .aadhaar-gradient {
            background: linear-gradient(90deg, #FDB913 0%, #FFFFFF 50%, #009900 100%);
            height: 4px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Top Branding Strip -->
    <div class="aadhaar-gradient"></div>

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-900 text-white p-2 rounded-lg">
                        <i class="fa-solid fa-fingerprint text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">UIDAI Data Insights</h1>
                        <p class="text-xs text-gray-500">Hackathon 2026 Dashboard</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium border border-green-200">
                        <i class="fa-solid fa-circle-check mr-1"></i> System Online
                    </span>
                    <button class="text-gray-400 hover:text-gray-600">
                        <i class="fa-solid fa-gear"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Controls & Filters -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 mb-8">
            <div class="flex flex-col md:flex-row md:items-end gap-6">
                
                <div class="flex-1">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Target State</label>
                    <div class="relative">
                        <i class="fa-solid fa-location-dot absolute left-3 top-3 text-gray-400"></i>
                        <input type="text" id="stateInput" value="Andhra Pradesh" 
                            class="pl-10 block w-full rounded-lg border-gray-300 bg-gray-50 border p-2.5 focus:ring-blue-500 focus:border-blue-500" readonly>
                    </div>
                </div>

                <div class="w-full md:w-48">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Row Limit</label>
                    <div class="relative">
                        <i class="fa-solid fa-list-ol absolute left-3 top-3 text-gray-400"></i>
                        <input type="number" id="limitInput" value="100" 
                            class="pl-10 block w-full rounded-lg border-gray-300 bg-gray-50 border p-2.5 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>

                <div class="w-full md:w-64">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Data Source</label>
                    <select id="sourceSelect" class="block w-full rounded-lg border-gray-300 border p-2.5 focus:ring-blue-500 focus:border-blue-500 bg-white">
                        <option value="mock">Demo Data (Preview)</option>
                        <option value="live">Live API (Requires Proxy)</option>
                    </select>
                </div>

                <button onclick="fetchData()" class="w-full md:w-auto px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-sm transition-colors flex items-center justify-center gap-2">
                    <i class="fa-solid fa-cloud-arrow-down"></i>
                    Retrieve Data
                </button>
            </div>
            
            <!-- API Key Warning (Hidden by default) -->
            <div id="apiKeyWarning" class="hidden mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800 flex items-start gap-2">
                <i class="fa-solid fa-triangle-exclamation mt-0.5"></i>
                <div>
                    <strong>Vercel Environment Variable Note:</strong> 
                    Client-side HTML cannot access <code>process.env.UIDAI_API_KEY</code> directly. 
                    <br>To use your secure key, point the "Live" request to a Vercel Serverless Function (e.g., <code>/api/uidai-proxy</code>).
                </div>
            </div>
        </div>

        <!-- Metrics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8" id="metricsArea">
            <!-- Populated by JS -->
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-5 border-b border-slate-200 flex justify-between items-center bg-gray-50">
                <h2 class="text-lg font-semibold text-gray-800">
                    Data Results 
                    <span id="resultCount" class="ml-2 px-2.5 py-0.5 rounded-full bg-blue-100 text-blue-800 text-xs">0 items</span>
                </h2>
                <div class="flex gap-2">
                    <button onclick="exportJSON()" class="text-sm px-3 py-1.5 border border-gray-300 rounded hover:bg-gray-100 text-gray-600">
                        <i class="fa-solid fa-code mr-1"></i> JSON
                    </button>
                    <button onclick="exportCSV()" class="text-sm px-3 py-1.5 border border-gray-300 rounded hover:bg-gray-100 text-gray-600">
                        <i class="fa-solid fa-file-csv mr-1"></i> CSV
                    </button>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm text-gray-600">
                    <thead class="bg-gray-50 text-xs uppercase text-gray-700">
                        <tr>
                            <th scope="col" class="px-6 py-4 font-bold border-b">District</th>
                            <th scope="col" class="px-6 py-4 font-bold border-b text-right">Aadhaar Generated</th>
                            <th scope="col" class="px-6 py-4 font-bold border-b text-right">Updates</th>
                            <th scope="col" class="px-6 py-4 font-bold border-b text-center">Gender</th>
                            <th scope="col" class="px-6 py-4 font-bold border-b text-center">Age Group</th>
                            <th scope="col" class="px-6 py-4 font-bold border-b text-center">Status</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody" class="divide-y divide-gray-200">
                        <tr>
                            <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                                Click "Retrieve Data" to load information.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <script>
        // State to hold our data
        let currentData = [];

        // Realistic Districts in Andhra Pradesh for Mock Data
        const apDistricts = [
            "Visakhapatnam", "Vijayawada", "Guntur", "Nellore", "Kurnool", 
            "Rajahmundry", "Tirupati", "Kakinada", "Kadapa", "Anantapur",
            "Vizianagaram", "Eluru", "Ongole", "Nandyal", "Machilipatnam"
        ];

        // --- MOCK DATA GENERATOR (For Demo) ---
        function generateMockData(count) {
            const data = [];
            for (let i = 0; i < count; i++) {
                const district = apDistricts[Math.floor(Math.random() * apDistricts.length)];
                const generated = Math.floor(Math.random() * 5000) + 1000;
                const updates = Math.floor(Math.random() * 3000) + 500;
                
                data.push({
                    id: `UID-${10000 + i}`,
                    state: "Andhra Pradesh",
                    district: district,
                    aadhaar_generated: generated,
                    aadhaar_updated: updates,
                    gender: Math.random() > 0.5 ? "Male" : "Female",
                    age_group: Math.random() > 0.3 ? "18-45" : (Math.random() > 0.5 ? "45+" : "0-18"),
                    status: Math.random() > 0.95 ? "Pending" : "Active"
                });
            }
            return data;
        }

        // --- MAIN FETCH FUNCTION ---
        async function fetchData() {
            const source = document.getElementById('sourceSelect').value;
            const limit = document.getElementById('limitInput').value;
            const tableBody = document.getElementById('tableBody');
            const apiKeyWarning = document.getElementById('apiKeyWarning');

            // Show Loading State
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="px-6 py-12 text-center text-blue-600">
                        <i class="fa-solid fa-circle-notch fa-spin text-3xl mb-2"></i>
                        <p>Fetching secure data from UIDAI Insights...</p>
                    </td>
                </tr>
            `;

            if (source === 'mock') {
                // SIMULATED API CALL
                apiKeyWarning.classList.add('hidden');
                setTimeout(() => {
                    currentData = generateMockData(parseInt(limit));
                    renderTable(currentData);
                    updateMetrics(currentData);
                }, 800); // Fake delay for realism

            } else {
                // REAL API CALL TEMPLATE
                // Note: This block shows how you would structure the call if you had the backend proxy
                apiKeyWarning.classList.remove('hidden');
                
                try {
                    // ------------------------------------------------------------
                    // VERCEL INTEGRATION INSTRUCTION:
                    // ------------------------------------------------------------
                    // 1. Create a file in your project: /api/get-uidai-data.js
                    // 2. In that file, read process.env.UIDAI_API_KEY
                    // 3. Make the fetch to the real UIDAI endpoint from there
                    // 4. Return the JSON to this frontend
                    // ------------------------------------------------------------

                    // Example of what the call would look like:
                    /*
                    const response = await fetch(`/api/get-uidai-data?limit=${limit}&state=AndhraPradesh`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    const result = await response.json();
                    currentData = result.data; // Adjust based on actual API response structure
                    renderTable(currentData);
                    */

                    // For now, since we don't have the proxy running, we revert to error
                    throw new Error("Backend proxy not found. Please implement the Vercel Function or switch to Demo Data.");

                } catch (error) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-8 text-center text-red-500 bg-red-50">
                                <i class="fa-solid fa-circle-exclamation text-2xl mb-2"></i>
                                <p><strong>Connection Failed:</strong> ${error.message}</p>
                                <p class="text-xs text-gray-500 mt-2">Switch to 'Demo Data' to preview the dashboard interface.</p>
                            </td>
                        </tr>
                    `;
                }
            }
        }

        // --- RENDER FUNCTIONS ---
        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            
            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="px-6 py-4 text-center">No records found</td></tr>`;
                return;
            }

            let html = '';
            data.forEach((row, index) => {
                html += `
                    <tr class="hover:bg-slate-50 transition-colors border-b last:border-0">
                        <td class="px-6 py-4 font-medium text-gray-900">${row.district}</td>
                        <td class="px-6 py-4 text-right font-mono text-blue-600">${row.aadhaar_generated.toLocaleString()}</td>
                        <td class="px-6 py-4 text-right font-mono text-green-600">${row.aadhaar_updated.toLocaleString()}</td>
                        <td class="px-6 py-4 text-center">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${row.gender === 'Male' ? 'bg-blue-100 text-blue-800' : 'bg-pink-100 text-pink-800'}">
                                ${row.gender}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-center text-gray-500 text-xs">${row.age_group}</td>
                        <td class="px-6 py-4 text-center">
                            <span class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium ${row.status === 'Active' ? 'bg-emerald-100 text-emerald-800' : 'bg-yellow-100 text-yellow-800'}">
                                <span class="w-1.5 h-1.5 rounded-full ${row.status === 'Active' ? 'bg-emerald-500' : 'bg-yellow-500'}"></span>
                                ${row.status}
                            </span>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
            document.getElementById('resultCount').innerText = `${data.length} records`;
        }

        function updateMetrics(data) {
            const totalGen = data.reduce((sum, item) => sum + item.aadhaar_generated, 0);
            const totalUpd = data.reduce((sum, item) => sum + item.aadhaar_updated, 0);
            const uniqueDistricts = [...new Set(data.map(item => item.district))].length;

            const cards = [
                { title: "Total Enrolments", value: totalGen.toLocaleString(), icon: "fa-id-card", color: "text-blue-600", bg: "bg-blue-50" },
                { title: "Total Updates", value: totalUpd.toLocaleString(), icon: "fa-rotate", color: "text-green-600", bg: "bg-green-50" },
                { title: "Districts Covered", value: uniqueDistricts, icon: "fa-map-location-dot", color: "text-purple-600", bg: "bg-purple-50" },
                { title: "Data Source", value: "Andhra Pradesh", icon: "fa-server", color: "text-orange-600", bg: "bg-orange-50" },
            ];

            const metricsArea = document.getElementById('metricsArea');
            metricsArea.innerHTML = cards.map(card => `
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-100 flex items-center gap-4">
                    <div class="${card.bg} ${card.color} w-12 h-12 rounded-lg flex items-center justify-center text-xl">
                        <i class="fa-solid ${card.icon}"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 font-medium">${card.title}</p>
                        <p class="text-xl font-bold text-gray-800">${card.value}</p>
                    </div>
                </div>
            `).join('');
        }

        // --- EXPORT UTILS ---
        function exportJSON() {
            if (currentData.length === 0) return alert("No data to export!");
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(currentData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "uidai_hackathon_data.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function exportCSV() {
            if (currentData.length === 0) return alert("No data to export!");
            const headers = Object.keys(currentData[0]);
            const csvRows = [
                headers.join(','), 
                ...currentData.map(row => headers.map(fieldName => JSON.stringify(row[fieldName], (key, value) => value === null ? '' : value)).join(','))
            ];
            const csvString = csvRows.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', 'uidai_hackathon_data.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Init with empty
        document.getElementById('resultCount').innerText = "Ready to fetch";
    </script>
</body>
</html>